<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core">

	<ui:param name="mbean" value="${vistoriaFaces}" />
	<ui:param name="mbeanModel" value="${vistoriaFaces.crudModel}" />
	<ui:param name="mbeanPesquisaModel"
		value="${vistoriaFaces.crudPesquisaModel}" />
	<ui:param name="reload" value="true" />



	<h:form prependId="false">
		<h:panelGrid id="pgTabView">
			<p:tabView id="tabView">
				<p:tab title="Vistorias" id="tabVistoria">


					<h:panelGrid>

						<p:fieldset legend="Filtro">



							<h:panelGrid styleClass="coluna100">
								<h:outputText value="Cliente" />
								<p:inputText value="#{mbean.cliente.nome}" styleClass="coluna50" />

								<p:commandButton value="Pesquisar" icon="ui-icon-search"
									action="#{mbean.findEvent}" update="gridPesquisa" />
							</h:panelGrid>


						</p:fieldset>

						<p:dataTable id="gridPesquisa" rendered="true"
							emptyMessage="Nenhum registro encontrado" style="width: 100%"
							paginator="true" paginatorAlwaysVisible="false" rows="10"
							value="#{mbean.lstVistoria}" var="linha" widgetVar="dtPesquisa">

							<p:column headerText="Cliente" styleClass="coluna60">
								<h:outputText value="#{linha.cliente.nome}" />
							</p:column>

							<p:column headerText="Data" styleClass="coluna10">
								<h:outputText value="#{linha.data}" />
							</p:column>

							<p:column headerText="Localização" styleClass="coluna10">

								<div align="center">

									<p:commandLink action="#{mbean.marcarMapa}" value="Ver no mapa" oncomplete="dlgMapa.show();" update="@parent:@parent:@parent:@parent:@parent:@parent:opMapa">
										<f:setPropertyActionListener target="#{mbean.crudModel}"
											value="#{linha}" />
									</p:commandLink>

								</div>
								
								</p:column>


								<p:column headerText="Enviar e-mail" styleClass="coluna10">

									<div align="center">

										<p:commandLink value="Enviar e-mail para cliente"
											action="#{mbean.enviarEmail}">
											<f:setPropertyActionListener target="#{mbean.crudModel}"
												value="#{linha}" />
										</p:commandLink>

									</div>

								</p:column>

								<p:column headerText="Baixar documento" styleClass="coluna10">

									<div align="center">

										<h:outputLink onclick="baixar('#{linha.id}');">Baixar documento</h:outputLink>

									</div>

								</p:column>


								<p:column headerText="Gerar Relatório" styleClass="coluna10">

									<div align="center">

										<p:commandLink id="clImpressao"
											action="#{mbean.geraQrCodeRelatorio}"
											oncomplete="printRelatorio();">
											<h:graphicImage value="../resources/images/6118_32x32.png"
												style="border: 0px" />
											<f:setPropertyActionListener target="#{mbean.crudModel}"
												value="#{linha}" />

										</p:commandLink>

									</div>

								</p:column>
						</p:dataTable>
					</h:panelGrid>

				</p:tab>
			</p:tabView>
		</h:panelGrid>

		<p:dialog modal="true" position="center" width="800" height="600"
			appendTo="@(body)" header="Local da vistoria" widgetVar="dlgMapa">

			<p:outputPanel id="opMapa">

				<p:gmap model="#{mbean.mapModel}" center="#{mbean.crudModel.latitude}, #{mbean.crudModel.longitude}" zoom="15" type="HYBRID"
					style="width:100%;height:590px" />

			</p:outputPanel>


		</p:dialog>

	</h:form>

	<script>
		function printRelatorio() {

			window.open('relatorio/vistoriaImpressao.xhtml', '_blank');

		}

		function baixar(vistoria) {

			window.open('/HuntVisionADM/word_document?vistoria_id=' + vistoria,
					'_blank');

		}
	</script>

</ui:composition>